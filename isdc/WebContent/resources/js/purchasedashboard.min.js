var cnt=0;var modalcnt=0;var jsonobject=new Array;var jsonobjectFinal=new Array;var jsonproductobject=new Array;var jsoncustomerobject=new Array;var jsonproductobjectfinal=new Array;var grandtotal=0;var grandquantity=0;$(document).ready(function(){$("tbody").on("change","input.productqty",function(){var e=this.id.split("-").pop();var t=$("#producttotalrate-"+e).html();var n=this.value;if($.isNumeric(n)&&parseInt(n)>0){var r=$("#productrowid-"+e).val();jsonproductobjectfinal[r].quantity=n;var i=0;var s=0;var o=parseFloat(n*t).toFixed(2);var u=parseInt($("#producttotaltaxvalue-"+e).val());var a=parseFloat(u/100*o).toFixed(2);var f=parseFloat(s/100*o).toFixed(2);var l=parseInt(n)+parseInt(i);var c=parseFloat((parseFloat(o)+parseFloat(a)).toFixed(2)-parseFloat(f)).toFixed(2);jsonproductobjectfinal[r].totalprice=c;jsonproductobjectfinal[r].totalqty=l;grandtotal=0;grandquantity=0;for(var h=0;h<jsonproductobjectfinal.length;h++){grandtotal=parseFloat(parseFloat(grandtotal)+parseFloat(jsonproductobjectfinal[h].totalprice)).toFixed(2);grandquantity+=jsonproductobjectfinal[h].totalqty}$("#producttotalamount-"+e).html("<div class='taxinnerleft'>Amount</div><div class='taxinnerright'>"+o+"</div>"+"<div class='taxinnerleft'>Tax</div><div class='taxinnerright'>"+a+"</div>"+"<div class='taxinnerleft'>Discount (-)</div><div class='taxinnerright'>"+f+"</div>"+"<div class='taxinnerlefttotal'>Total</div><div class='taxinnerrighttotal'>"+c+"</div><div class='clearboth'></div>"+"<input id='producttotaldiscountvalue-"+e+"' type='hidden' value='"+f+"' />"+"<input id='producttotalprice-"+e+"' type='hidden' value='"+c+"' />");$("#producttotalqty-"+e).html("<div class='taxinnerleft'>Items</div><div class='taxinnerright'>"+n+"</div>"+"<div class='taxinnerleft'>Free Items</div><div class='taxinnerright'>"+i+"</div>"+"<div class='taxinnerlefttotal'>Total</div><div class='taxinnerrighttotal'>"+l+"</div><div class='clearboth'></div>"+"<input id='producttotalfreeitemvalue-"+e+"' type='hidden' value='"+i+"' />"+"<input id='producttotalquantity-"+e+"' type='hidden' value='"+l+"' />");$("#productselectedscheme-"+e).html("");$("#grandtotal").html("<div class='taxinnerlefttotal'>Total</div><div class='taxinnerrighttotal'>"+grandtotal+"</div><div class='clearboth'></div>");$("#grandquantity").html("<div class='taxinnerlefttotal'>Total</div><div class='taxinnerrighttotal'>"+grandquantity+"</div><div class='clearboth'></div>")}else{$("#errorbox").html("<strong>Error!</strong> Quantity can only be a numeric value, greater than zero.");$("#errorbox").show();window.setTimeout(function(){$("#errorbox").hide()},5e3)}});$("tbody").on("click","a.productremove",function(){var e=this.id.split("-").pop();var t=null;for(var n=0;n<jsonproductobjectfinal.length;n++){if(jsonproductobjectfinal[n].id==e){t=n;break}}var r=new Array;for(var n=0;n<jsonproductobjectfinal.length;n++){if(n!=t){r.push(jsonproductobjectfinal[n])}}jsonproductobjectfinal=r;modalcnt--;grandtotal=0;grandquantity=0;for(var i=0;i<jsonproductobjectfinal.length;i++){grandtotal=parseFloat(parseFloat(grandtotal)+parseFloat(jsonproductobjectfinal[i].totalprice)).toFixed(2);grandquantity+=jsonproductobjectfinal[i].totalqty}$("#grandtotal").html("Total Amount: "+grandtotal);$("#grandquantity").html("Total Quantity: "+grandquantity);$("#productrow-"+t).remove()});$(document).on("click",".open-AddBookDialog",function(){var e=$(this).data("id");var t=jsonproductobjectfinal[e].value;$(".modal-body #modalId").val(e);var n="";var r=parseInt($("#productqty-"+t).val());var i=0;$.each(jsonproductobjectfinal[e].productschemelist,function(e,t){i++;if(i==1){n+="<table class='productscheme' border='1'><thead><tr><td>ID</td><td>Name</td><td>Type</td><td>Discount/Free Items</td><td>Min Qty</td><td>Select</td></tr></thead><tbody>"}var s="";var o="";if(t.scheme_type){s="Free Item";o=" items"}else{s="Percentage Discount";o=" %"}var u="";if(t.scheme_selected!=null&&t.scheme_selected==true){u="checked"}if(r>=t.scheme_qty){n+="<tr><td>"+t.scheme_id+"</td><td>"+t.scheme_name+" : "+t.scheme_name+"</td><td>"+s+"</td><td>"+t.scheme_value+o+"</td><td>"+t.scheme_qty+"</td><td><input type='checkbox' name='schemecheckboxes' value='"+t.scheme_id+"' "+u+" /></td></tr>"}else{n+="<tr><td>"+t.scheme_id+"</td><td>"+t.scheme_name+"</td><td>"+t.scheme_type+"</td><td>"+t.scheme_value+"</td><td>"+t.scheme_qty+"</td><td></td></tr>"}});if(i==0){n+="<tr><td colspan='6'>Currently no schemes available for this product</td></tr>"}n+="</tbody></table>";$("#schemeModal .content").html(n)});$("#schemeModal .go-back-button").click(function(){$("#schemeModal").modal("hide")});$("#schemeModal .okay-button").click(function(){$("#schemeModal").modal("hide");var e=$(".modal-body #modalId").val();var t=jsonproductobjectfinal[e].value;var n=null;for(var r=0;r<jsonproductobjectfinal.length;r++){if(jsonproductobjectfinal[r].id==t){n=r;break}}var i="";var s=0;var o=0;$.each(jsonproductobjectfinal[e].productschemelist,function(e,t){t.scheme_selected=false});$("#schemeModal .content input:checked").each(function(){var t=$(this).attr("value");$.each(jsonproductobjectfinal[e].productschemelist,function(e,n){if(n.scheme_id==t){n.scheme_selected=true;var r="";var u="";if(n.scheme_type){r="Free Item";u=" items";o+=n.scheme_value}else{r="Percentage Discount";u=" %";s+=n.scheme_value}i+="<div class='taxinnerleft'>"+r+"</div><div class='taxinnerright'>"+n.scheme_value+u+"</div><div class='clearboth'></div>"}})});$("#productselectedscheme-"+t).html(i);var u=$("#productqty-"+t).val();var a=parseInt(u)+parseInt(o);var f=$("#producttotalrate-"+t).html();var l=parseFloat(u*f).toFixed(2);var c=$("#producttotaltaxvalue-"+t).val();var h=parseFloat(c/100*l).toFixed(2);var p=parseFloat(s/100*l).toFixed(2);var d=parseFloat((parseFloat(l)+parseFloat(h)).toFixed(2)-parseFloat(p)).toFixed(2);jsonproductobjectfinal[n].totalprice=d;jsonproductobjectfinal[n].totalqty=a;grandtotal=0;grandquantity=0;for(var v=0;v<jsonproductobjectfinal.length;v++){grandtotal=parseFloat(parseFloat(grandtotal)+parseFloat(jsonproductobjectfinal[v].totalprice)).toFixed(2);grandquantity+=jsonproductobjectfinal[v].totalqty}$("#producttotalamount-"+t).html("<div class='taxinnerleft'>Amount</div><div class='taxinnerright'>"+l+"</div>"+"<div class='taxinnerleft'>Tax</div><div class='taxinnerright'>"+h+"</div>"+"<div class='taxinnerleft'>Discount (-)</div><div class='taxinnerright'>"+p+"</div>"+"<div class='taxinnerlefttotal'>Total</div><div class='taxinnerrighttotal'>"+d+"</div><div class='clearboth'></div>"+"<input id='producttotaldiscountvalue-"+t+"' type='hidden' value='"+p+"' />"+"<input id='producttotalprice-"+t+"' type='hidden' value='"+d+"' />");$("#producttotalqty-"+t).html("<div class='taxinnerleft'>Items</div><div class='taxinnerright'>"+u+"</div>"+"<div class='taxinnerleft'>Free Items</div><div class='taxinnerright'>"+o+"</div>"+"<div class='taxinnerlefttotal'>Total</div><div class='taxinnerrighttotal'>"+a+"</div><div class='clearboth'></div>"+"<input id='producttotalfreeitemvalue-"+t+"' type='hidden' value='"+o+"' />"+"<input id='producttotalquantity-"+t+"' type='hidden' value='"+a+"' />");$("#grandtotal").html("<div class='taxinnerlefttotal'>Total</div><div class='taxinnerrighttotal'>"+grandtotal+"</div><div class='clearboth'></div>");$("#grandquantity").html("<div class='taxinnerlefttotal'>Total</div><div class='taxinnerrighttotal'>"+grandquantity+"</div><div class='clearboth'></div>")});$("#totalformsumit").click(function(e){var t=$("#customerid").val();var n=$("#invoiceno").html();if($("#customerid").val().length>0){var r={invoicenumber:n,customerid:t,listautocompleteproductResponse:jsonproductobjectfinal};$.ajax({type:"POST",url:salesaentryurl,contentType:"application/json",data:JSON.stringify(r),success:function(e){window.location="dashboard?message=create-success"}})}else{$("#errorbox").html("<strong>Error!</strong> Please select a customer!");$("#errorbox").show();window.setTimeout(function(){$("#errorbox").hide()},5e3)}e.preventDefault();return false});$("#totalformsumitprint").click(function(e){var t=$("#customerid").val();var n=$("#invoiceno").html();if($("#customerid").val().length>0){var r={invoicenumber:n,customerid:t,listautocompleteproductResponse:jsonproductobjectfinal};$.ajax({type:"POST",url:salesaentryurl,contentType:"application/json",data:JSON.stringify(r),success:function(e){var t=window.open("print?id="+e,"Print","menubar=0,location=0,height=600,width=800");t.print();window.location="dashboard?message=create-success"}})}else{$("#errorbox").html("<strong>Error!</strong> Please select a customer!");$("#errorbox").show();window.setTimeout(function(){$("#errorbox").hide()},5e3)}e.preventDefault();return false});$("#productModal .go-back-button").click(function(){$("#productModal").modal("hide")});$("#productModal .search-button").click(function(e){$.ajax({type:"POST",url:productnameurl,async:true,data:{term:$("#modal-product-name-code").val(),type:$("#modal-product-type").val()},success:function(e){jsonproductobject=e;var t="";t+="<table class='productscheme' border='1'><thead><tr><td>ID</td><td>Code</td><td>Name</td><td>Rate</td><td>Quantity</td><td>Weight</td><td>Select</td></tr></thead><tbody>";for(var n=0;n<e.length;n++){t+="<tr><td>"+e[n].id+"</td><td>"+e[n].code+"</td><td>"+e[n].name+"</td><td>"+e[n].rate+"</td><td>"+e[n].quantity+"</td><td>"+e[n].weight+"</td><td><span class='modal-product-link' data-id="+n+">Add to cart</span></td></tr>"}t+="</tbody></table>";$("#modal-product-content").html(t)}});e.preventDefault();return false});$(document).on("click","#productModal .modal-product-link",function(e){var t=$(this).attr("data-id");var n=true;for(var r=0;r<jsonproductobjectfinal.length;r++){if(jsonproductobject[t].value==jsonproductobjectfinal[r].value){n=false}}if(n){jsonproductobjectfinal[modalcnt]=jsonproductobject[t];$("#mainTable > tbody").append("<tr id='productrow-"+modalcnt+"'><td><input type='hidden' id='productrowid-"+jsonproductobjectfinal[modalcnt].value+"' value='"+modalcnt+"'></input>"+jsonproductobjectfinal[modalcnt].value+"</td><td>"+jsonproductobjectfinal[modalcnt].code+"</td><td>"+jsonproductobjectfinal[modalcnt].name+"</br>(<a href='#' id='productremove-"+jsonproductobjectfinal[modalcnt].value+"' class='productremove'>delete</a>)</td><td><input type='text' id='productqty-"+jsonproductobjectfinal[modalcnt].value+"' class='productqty' value='"+jsonproductobjectfinal[modalcnt].quantity+"'></input></td><td><div id='producttotalrate-"+jsonproductobjectfinal[modalcnt].value+"'>"+jsonproductobjectfinal[modalcnt].rate+"</div></td><td valign='top'><div class='producttax' id='producttax-"+jsonproductobjectfinal[modalcnt].value+"'></div></td><td valign='top'><a class='open-AddBookDialog' data-toggle='modal' data-id='"+modalcnt+"' data-target='#schemeModal'>+ select</a><div id='productselectedscheme-"+jsonproductobjectfinal[modalcnt].value+"'></div></td><td valign='top'><div class='productqty' id='producttotalqty-"+jsonproductobjectfinal[modalcnt].value+"'>Total Qty : 1</div></td><td><div class='productamount' id='producttotalamount-"+jsonproductobjectfinal[modalcnt].value+"'></div></td></tr>");var i="";var s=0;var o=0;var u=0;var a=parseFloat(jsonproductobjectfinal[modalcnt].quantity*jsonproductobjectfinal[modalcnt].rate).toFixed(2);$.each(jsonproductobjectfinal[modalcnt].taxmasterlist,function(e,t){i+="<div class='taxinnerleft'>"+t.tax_name+"</div><div class='taxinnerright'>"+t.tax_percentage+"%</div>";s+=t.tax_percentage});var f=parseFloat(s/100*a).toFixed(2);var l=parseFloat(u/100*a).toFixed(2);var c=parseFloat((parseFloat(a)+parseFloat(f)).toFixed(2)-parseFloat(l)).toFixed(2);var h=jsonproductobjectfinal[modalcnt].quantity;var p=parseInt(h)+parseInt(o);$("#producttax-"+jsonproductobjectfinal[modalcnt].value).html(i+"<div class='taxinnerlefttotal'>Total</div><div class='taxinnerrighttotal'>"+s+"%</div><div class='clearboth'></div>"+"<input id='producttotaltaxvalue-"+jsonproductobjectfinal[modalcnt].value+"' type='hidden' value='"+s+"' />");$("#producttotalamount-"+jsonproductobjectfinal[modalcnt].value).html("<div class='taxinnerleft'>Amount</div><div class='taxinnerright'>"+a+"</div>"+"<div class='taxinnerleft'>Tax</div><div class='taxinnerright'>"+f+"</div>"+"<div class='taxinnerleft'>Discount (-)</div><div class='taxinnerright'>"+l+"</div>"+"<div class='taxinnerlefttotal'>Total</div><div class='taxinnerrighttotal'>"+c+"</div><div class='clearboth'></div>"+"<input id='producttotaldiscountvalue-"+jsonproductobjectfinal[modalcnt].value+"' type='hidden' value='"+l+"' />"+"<input id='producttotalprice-"+jsonproductobjectfinal[modalcnt].value+"' type='hidden' value='"+c+"' />");$("#producttotalqty-"+jsonproductobjectfinal[modalcnt].value).html("<div class='taxinnerleft'>Items</div><div class='taxinnerright'>"+h+"</div>"+"<div class='taxinnerleft'>Free Items</div><div class='taxinnerright'>"+o+"</div>"+"<div class='taxinnerlefttotal'>Total</div><div class='taxinnerrighttotal'>"+p+"</div><div class='clearboth'></div>"+"<input id='producttotalfreeitemvalue-"+jsonproductobjectfinal[modalcnt].value+"' type='hidden' value='"+o+"' />"+"<input id='producttotalquantity-"+jsonproductobjectfinal[modalcnt].value+"' type='hidden' value='"+p+"' />");if(modalcnt==0){$("#mainTable > tfoot").append("<tr><td colspan='7'></td><td class='footertotals'><div id='grandquantity'></div></td><td class='footertotals'><div id='grandtotal'></div></td></tr>")}jsonproductobjectfinal[modalcnt].totalprice=c;jsonproductobjectfinal[modalcnt].totalqty=p;grandtotal=0;grandquantity=0;for(var r=0;r<jsonproductobjectfinal.length;r++){grandtotal=parseFloat(parseFloat(grandtotal)+parseFloat(jsonproductobjectfinal[r].totalprice)).toFixed(2);grandquantity+=jsonproductobjectfinal[r].totalqty}$("#grandtotal").html("<div class='taxinnerlefttotal'>Total</div><div class='taxinnerrighttotal'>"+grandtotal+"</div><div class='clearboth'></div>");$("#grandquantity").html("<div class='taxinnerlefttotal'>Total</div><div class='taxinnerrighttotal'>"+grandquantity+"</div><div class='clearboth'></div>");modalcnt++}$("#productModal").modal("hide");$("#divbutton").show();e.preventDefault();return false});$("#customerModal .search-button").click(function(e){$.ajax({type:"POST",url:customernameurl,async:true,data:{term:$("#modal-customer-name").val()},success:function(e){jsoncustomerobject=e;var t="";t+="<table class='customertable' border='1'><thead><tr><td>ID</td><td>Name</td><td>Pin</td><td>Phone</td><td>Mobile</td><td>Select</td></tr></thead><tbody>";for(var n=0;n<e.length;n++){t+="<tr><td>"+e[n].customer_id+"</td><td>"+e[n].customer_name+"</td><td>"+e[n].customer_pin+"</td><td>"+e[n].customer_phone+"</td><td>"+e[n].customer_mobile+"</td><td><span class='modal-customer-link' data-id="+n+">Select</span></td></tr>"}t+="</tbody></table>";$("#modal-customer-content").html(t)}});e.preventDefault();return false});$(document).on("click","#customerModal .modal-customer-link",function(e){var t=$(this).attr("data-id");$("#customerid").val(jsoncustomerobject[t].customer_id);$("#customer-name").val(jsoncustomerobject[t].customer_name);$("#customerModal").modal("hide");e.preventDefault();return false})})